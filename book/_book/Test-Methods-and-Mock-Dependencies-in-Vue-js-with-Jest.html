
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>6. Test Methods and Mock Dependencies in Vue.js with Jest Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="Learn how to test methods and cope with mocking module dependencies.">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Test-Vue-js-Slots-in-Jest.html" />
    
    
    <link rel="prev" href="Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Write-the-first-Vue-js-Component-Unit-Test-in-Jest.html">
            
                <a href="Write-the-first-Vue-js-Component-Unit-Test-in-Jest.html">
            
                    
                    1. Write the first Vue.js Component Unit Test in Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Test-Deeply-Rendered-Vue-js-Components-in-Jest.html">
            
                <a href="Test-Deeply-Rendered-Vue-js-Components-in-Jest.html">
            
                    
                    2. Test Deeply Rendered Vue.js Components in Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Test-Styles-and-Structure-of-Vue-js-Components-in-Jest.html">
            
                <a href="Test-Styles-and-Structure-of-Vue-js-Components-in-Jest.html">
            
                    
                    3. Test Styles and Structure of Vue.js Components in Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Test-Properties-and-Custom-Events-in-Vue-js-Components-with-Jest.html">
            
                <a href="Test-Properties-and-Custom-Events-in-Vue-js-Components-with-Jest.html">
            
                    
                    4. Test Properties and Custom Events in Vue.js Components with Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.html">
            
                <a href="Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.html">
            
                    
                    5. Test Computed Properties and Watchers in Vue.js Components with Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="Test-Methods-and-Mock-Dependencies-in-Vue-js-with-Jest.html">
            
                <a href="Test-Methods-and-Mock-Dependencies-in-Vue-js-with-Jest.html">
            
                    
                    6. Test Methods and Mock Dependencies in Vue.js with Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Test-Vue-js-Slots-in-Jest.html">
            
                <a href="Test-Vue-js-Slots-in-Jest.html">
            
                    
                    7. Test Vue.js Slots in Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Enhance-Jest-configuration-with-Module-Aliases.html">
            
                <a href="Enhance-Jest-configuration-with-Module-Aliases.html">
            
                    
                    8. Enhance Jest configuration with Module Aliases
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >6. Test Methods and Mock Dependencies in Vue.js with Jest</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="test-methods-and-mock-dependencies-in-vuejs-with-jest">Test Methods and Mock Dependencies in Vue.js with Jest</h1>
<p>Learn how to test methods and cope with mocking module dependencies.</p>
<!-- more -->
<p>What should we test in methods? That&apos;s a question that we had when we started doing unit tests. Everything comes down to <strong>test what that method do, and just that</strong>. This means we need to <strong>avoid calls to any dependency</strong>, so we&apos;ll need to mock them.</p>
<p>Let&apos;s add a <code>onSubmit</code> event to the form in the <code>Form.vue</code> component that we created in the <a href="2017/09/18/Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest">last article</a>:</p>
<pre><code class="lang-html">...
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">&quot;onSubmit(inputValue)&quot;</span>&gt;</span>
...
</code></pre>
<p>The <code>.prevent</code> modifier is just a convenient way to call <code>event.preventDefault()</code> in order to don&apos;t reload the page. Now make some modifications to call an api and store the result, by adding a <code>results</code> array to the data and a <code>onSubmit</code> method:</p>
<pre><code class="lang-javascript">data: () =&gt; ({
  inputValue: <span class="hljs-string">&apos;&apos;</span>,
  results: []
}),
methods: {
  onSubmit(value) {
    axios.get(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=&apos;</span> + value).then(results =&gt; {
      <span class="hljs-keyword">this</span>.results = results.data
    })
  }
},
...
</code></pre>
<p>The method is using axios to perform an HTTP call to the &quot;posts&quot; endpoint of jsonplaceholder, which is just a RESTful API for this kind of examples, and with the <code>q</code> query parameter we can search for posts, using the <code>value</code> provided as parameter.</p>
<p>For testing the <code>onSubmit</code> method:</p>
<ul>
<li>We don&apos;t wanna call <code>axios.get</code> actual method</li>
<li>We wanna check it is calling axios (but not the real one) and it returns a promise</li>
<li>That promise callback should set <code>this.results</code> to the promise result</li>
</ul>
<p>This is probably one of the hardest things to test, when you have external dependencies plus those return promises that do things inside. What we need to do is to <strong>mock the external dependencies</strong>.</p>
<h2 id="mock-external-module-dependencies">Mock External Module Dependencies</h2>
<p>Jest provides a really great mocking system that allows you to mock everything in a quite convenient way. You don&apos;t need any extra libraries for that. We have seen already <code>jest.spyOn</code> and <code>jest.fn</code> for spying and creating stub functions, although that&apos;s not enough for this case.</p>
<p>We need to mock the whole <code>axios</code> module. Here&apos;s where <code>jest.mock</code> comes into the stage. It allow us to easily mock module dependencies by writing at the top of you file:</p>
<pre><code class="lang-javascript">jest.mock(<span class="hljs-string">&apos;dependency-path&apos;</span>, implementationFunction)
</code></pre>
<p>You must know that <strong><code>jest.mock</code> is hoisted</strong>, which means it will be placed at the top. So:</p>
<pre><code class="lang-javascript">jest.mock(<span class="hljs-string">&apos;something&apos;</span>, jest.fn)
<span class="hljs-keyword">import</span> foo <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;bar&apos;</span>
...
</code></pre>
<p>Is equivalent to:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> foo <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;bar&apos;</span>
jest.mock(<span class="hljs-string">&apos;something&apos;</span>, jest.fn) <span class="hljs-comment">// this will end up above all imports and everything</span>
...
</code></pre>
<p>By the date of writing, I still haven&apos;t seen much info about how to do in Jest what we&apos;re gonna do here on the internet. Lucky you don&apos;t have to go through the same struggle.</p>
<p>Let&apos;s write the mock for axios at the top of the <code>Form.test.js</code> test file, and the corresponding test case:</p>
<pre><code class="lang-javascript">jest.mock(<span class="hljs-string">&apos;axios&apos;</span>, () =&gt; ({
  get: jest.fn()
}))

<span class="hljs-keyword">import</span> { shallow } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;vue-test-utils&apos;</span>
<span class="hljs-keyword">import</span> Form <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;../src/components/Form&apos;</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;axios&apos;</span> <span class="hljs-comment">// axios here is the mock from above!</span>

...

it(<span class="hljs-string">&apos;Calls axios.get&apos;</span>, () =&gt; {
  cmp.vm.onSubmit(<span class="hljs-string">&apos;an&apos;</span>)
  expect(axios.get).toBeCalledWith(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=an&apos;</span>)
})
</code></pre>
<p>This is great, we&apos;re indeed mocking axios, so the original axios is not called nor any HTTP call. And, we&apos;re even checking by using <code>toBeCalledWith</code> that it&apos;s been called with the right parameters. But we&apos;re still missing something: <strong><em>we&apos;re not checking that it returns a promise</em></strong>.</p>
<p>First we need to make our mocked <code>axios.get</code> method to return a promise. <code>jest.fn</code> accepts a factory function as a parameter, so we can use it to define its implementation:</p>
<pre><code class="lang-javascript">jest.mock(<span class="hljs-string">&apos;axios&apos;</span>, () =&gt; ({
  get: jest.fn(() =&gt; <span class="hljs-built_in">Promise</span>.resolve({ data: <span class="hljs-number">3</span> }))
}))
</code></pre>
<p>But still, we cannot access the promise, because we&apos;re not returning it. In testing, is a good practice to return something from a function when possible, it makes testing much easier. Let&apos;s do it then in the <code>onSubmit</code> method of the <code>Form.vue</code> component:</p>
<pre><code class="lang-javascript">onSubmit(value) {
  <span class="hljs-keyword">const</span> getPromise = axios.get(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=&apos;</span> + value)

  getPromise.then(results =&gt; {
    <span class="hljs-keyword">this</span>.results = results.data
  })

  <span class="hljs-keyword">return</span> getPromise
}
</code></pre>
<p>Then we can use the very clean ES2017 <code>async/await</code> syntax in the test to check the promise result:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;Calls axios.get and checks promise result&apos;</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> cmp.vm.onSubmit(<span class="hljs-string">&apos;an&apos;</span>)

  expect(result).toEqual({ data: [<span class="hljs-number">3</span>] })
  expect(cmp.vm.results).toEqual([<span class="hljs-number">3</span>])
  expect(axios.get).toBeCalledWith(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=an&apos;</span>)
})
</code></pre>
<p>You can see that we don&apos;t only check the promise result, but also that the <code>results</code> internal state of the component is updated as expected, by doing <code>expect(cmp.vm.results).toEqual([3])</code>.</p>
<h2 id="keep-mocks-externalized">Keep mocks externalized</h2>
<p>Jest allows us to have all our mocks separated in their own JavaScript file, placing them under a <code>__mocks__</code> folder, keeping the tests as clean as possible.</p>
<p>So we can take the <code>jest.mock...</code> block from top of the <code>Form.test.js</code> file out to it&apos;s own file:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// test/__mocks__/axios.js</span>
<span class="hljs-built_in">module</span>.exports = {
  get: jest.fn(() =&gt; <span class="hljs-built_in">Promise</span>.resolve({ data: [<span class="hljs-number">3</span>] }))
}
</code></pre>
<p>Just like this, with no extra effort, Jest automatically applies the mock in all our tests so we don&apos;t have to do anything extra or mocking it in every test manually. Notice the module name must match the file name. If you run the tests again, they should still pass.</p>
<p>Keep in mind the modules registry and the mocks state is kept, so if you write another test afterwards, you may get undesired results:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;Calls axios.get&apos;</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> cmp.vm.onSubmit(<span class="hljs-string">&apos;an&apos;</span>)

  expect(result).toEqual({ data: [<span class="hljs-number">3</span>] })
  expect(cmp.vm.results).toEqual([<span class="hljs-number">3</span>])
  expect(axios.get).toBeCalledWith(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=an&apos;</span>)
})

it(<span class="hljs-string">&apos;Axios should not be called here&apos;</span>, () =&gt; {
  expect(axios.get).toBeCalledWith(<span class="hljs-string">&apos;https://jsonplaceholder.typicode.com/posts?q=an&apos;</span>)
})
</code></pre>
<p>The second test should fail, but it doesn&apos;t! That&apos;s because <code>axios.get</code> was called on the test before.</p>
<p>For that reason, it&apos;s a good practice to clean the module registry and the mocks, since they&apos;re manipulated by Jest in order to make mocking happen. For that you can add in your <code>beforeEach</code>:</p>
<pre><code class="lang-javascript">beforeEach(() =&gt; {
  cmp = shallow(Form)
  jest.resetModules()
  jest.clearAllMocks()
})
</code></pre>
<p>That will ensure each test starts with clean mocks and modules, as it should be in unit testing.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Jest mocking feature, along with snapshot testing, are what I love the most of Jest! It makes very easy what usually is quite hard to test, and focus on writing faster and better isolated tests and keep your codebase bullet-proof.</p>
<p>You can find the code of this article <a href="https://github.com/alexjoverm/vue-testing-series/tree/Test-State-Computed-Properties-and-Methods-in-Vue-js-Components-with-Jest" target="_blank">in this repo</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.html" class="navigation navigation-prev " aria-label="Previous page: 5. Test Computed Properties and Watchers in Vue.js Components with Jest">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Test-Vue-js-Slots-in-Jest.html" class="navigation navigation-next " aria-label="Next page: 7. Test Vue.js Slots in Jest">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"6. Test Methods and Mock Dependencies in Vue.js with Jest","tags":["VueJS","JavaScript","Testing"],"description":"Learn how to test methods and cope with mocking module dependencies.","date":"2017-09-25T08:18:23.000Z","level":"1.7","depth":1,"next":{"title":"7. Test Vue.js Slots in Jest","level":"1.8","depth":1,"path":"Test-Vue-js-Slots-in-Jest.md","ref":"Test-Vue-js-Slots-in-Jest.md","articles":[]},"previous":{"title":"5. Test Computed Properties and Watchers in Vue.js Components with Jest","level":"1.6","depth":1,"path":"Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.md","ref":"Test-Computed-Properties-and-Watchers-in-Vue-js-Components-with-Jest.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":16,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Test-Methods-and-Mock-Dependencies-in-Vue-js-with-Jest.md","mtime":"2017-10-06T16:50:17.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-10-06T16:50:25.417Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

